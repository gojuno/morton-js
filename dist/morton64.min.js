!function(s,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("long"),require("sprintf-js").sprintf):"function"==typeof define&&define.amd?define(["long","sprintf-js"],t):s.Morton64=t(s.Long,s.sprintf)}(this,function(s,t){function i(i,n){if(i<=0||n<=0||i*n>64)throw t("can't make morton64 with %d dimensions and %d bits",i,n);this.dimensions=s.fromInt(i),this.bits=s.fromInt(n);var h=s.ONE.shl(this.bits).sub(1),r=this.dimensions.mul(this.bits.sub(1));for(r=r.or(r.shru(1)),r=r.or(r.shru(2)),r=r.or(r.shru(4)),r=r.or(r.shru(8)),r=r.or(r.shru(16)),r=r.or(r.shru(32)),r=r.sub(r.shru(1)),this.masks=[],this.lshifts=[],this.masks.push(h),this.lshifts.push(s.ZERO);r.greaterThan(0);){h=s.ZERO;for(var o=s.ZERO,e=0;e<this.bits;e++){var u=this.dimensions.mul(e).sub(e);o=o.or(r.and(u)),h=h.or(s.ONE.shl(e).shl(r.sub(1).not().and(u)))}o.notEquals(0)&&(this.masks.push(h),this.lshifts.push(r)),r=r.shru(1)}this.rshifts=[];for(var a=0;a<this.lshifts.length-1;a++)this.rshifts.push(this.lshifts[a+1]);this.rshifts.push(s.ZERO)}return i.prototype.pack=function(t){this.dimensionsCheck(t.length);for(var i=0;i<t.length;i++)this.valueCheck(t[i]);for(var n=s.ZERO,i=0;i<t.length;i++)n=n.or(this.split(t[i]).shl(i));return n},i.prototype.spack=function(s){for(var t=[],i=0;i<s.length;i++)t.push(this.shiftSign(s[i]));return this.pack(t)},i.prototype.unpack=function(s){for(var t=[],i=0;i<this.dimensions;i++)t[i]=this.compact(s.shru(i));return t},i.prototype.sunpack=function(s){for(var t=this.unpack(s),i=0;i<t.length;i++)t[i]=this.unshiftSign(t[i]);return t},i.prototype.dimensionsCheck=function(s){if(this.dimensions!=s)throw t("morton64 with %d dimensions received %d values",this.dimensions,s)},i.prototype.valueCheck=function(i){if(i.lessThan(0)||i.greaterThanOrEqual(s.ONE.shl(this.bits)))throw t("morton64 with %d bits per dimension received %d to pack",this.bits,i)},i.prototype.shiftSign=function(i){if(i.greaterThanOrEqual(s.ONE.shl(this.bits-1))||i.lessThanOrEqual(s.ONE.shl(this.bits-1).negate()))throw t("morton64 with %d bits per dimension received signed %d to pack",this.bits,i);return i.lessThan(0)&&(i=i.negate().or(s.ONE.shl(this.bits-1))),i},i.prototype.unshiftSign=function(t){var i=t.and(s.ONE.shl(this.bits-1));return t=t.and(s.ONE.shl(this.bits-1).sub(1)),i.equals(0)||(t=t.negate()),t},i.prototype.split=function(s){for(var t=0;t<this.masks.length;t++)s=s.or(s.shl(this.lshifts[t])).and(this.masks[t]);return s},i.prototype.compact=function(s){for(var t=this.masks.length-1;t>=0;t--)s=s.or(s.shru(this.rshifts[t])).and(this.masks[t]);return s},i});